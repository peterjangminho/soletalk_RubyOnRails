# VoiceChat Engine Ideation v2 - Personal Ontology Building

> **Created**: 2025-12-06
> **Version**: 2.0 (Ontology 타입 매핑 + 외부 정보 활용 추가)
> **Purpose**: 대화엔진 재설계 - 개인 온톨로지 구축 + 인사이트 기반 행동 가이드

---

## 1. 핵심 재정의

### 현재 vs 목표

```
현재: 대화 지속 → 감정 표현 → (끝)
      "말만 더 시키는 구조"

목표: 대화 → 구조화 → 외부정보 연결 → 인사이트 → 더 나은 선택 가이드
      "개인 온톨로지 구축 + 실시간 정보 기반 행동 인사이트"
```

### 최종 Output 형태

```
"지금은 [상황]이고,
 [정보/이유] 때문에,
 [목적]을 위해서,
 지금은 [행동 가이드]가 좋을 것 같아요"
```

### SoleTalk 환경의 이점

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      SoleTalk = Solo + Talk                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Privacy:                                                                    │
│  • 혼자 있는 공간 → 솔직한 대화 가능                                        │
│  • 아무도 듣지 않음 → 숨기고 싶은 것도 말할 수 있음                          │
│  • 눈치 볼 필요 없음 → 감정 표현 자유로움                                   │
│                                                                              │
│  Time:                                                                       │
│  • 출퇴근 시간 = 고정된 대화 시간 (하루 2회 보장)                            │
│  • 다른 일 하기 어려움 → 대화에 집중                                        │
│  • 반복적 루틴 → 습관 형성 + 변화 추적 용이                                 │
│                                                                              │
│  State:                                                                      │
│  • 출근길: 하루 계획, 에너지 높음, 목표 설정                                │
│  • 퇴근길: 하루 회고, 감정 처리, 결정 고민                                  │
│  • 운전 중: 손 사용 불가 → 음성 대화 최적                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 4가지 핵심 질문 (4 Core Questions)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      4 Core Questions (직접 버전)                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Q1. WHY (진짜 이유)                                                         │
│      "너는 진실로 왜 지금 이러니?"                                            │
│      → 표면 감정 vs 숨겨진 감정                                              │
│      → 화가 난 게 아니라 사실은 두려운 것                                     │
│      → 스스로 모를 때가 많음                                                 │
│                                                                              │
│  Q2. WHAT DECISION (어떤 결정)                                               │
│      "궁극적으로 어떤 의사결정을 위한 고민이니?"                               │
│      → 뭘 해야 하는지 vs 뭘 하고 싶은지                                       │
│      → 왜 결정을 미루는지                                                    │
│      → 인지하기가 어려움                                                     │
│                                                                              │
│  Q3. IMPACT (영향)                                                           │
│      "그 결정이 되면 영향은 어떠한가?"                                        │
│      → 감정적 / 관계적 / 사회적 / 금전적 / 심리적                             │
│      → 명목적 영향 vs 숨기고 싶은 영향                                        │
│      → measure 하거나 구체화하기 힘듦                                        │
│                                                                              │
│  Q4. WHAT DATA (필요한 정보)                                                 │
│      "이를 위해 어떤 정보가 필요한가?"                                        │
│      → 어디서 찾는지 모르거나 잊어버린 정보                                   │
│      → 개인사는 구체화되기 힘듦                                              │
│      → 개인/사회/관계/트라우마 등 모두 연결되어 있음                          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 외부 정보 활용 - 업데이트식 발화 유도

### 3.1 정보 유형별 활용 전략

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    외부 정보 기반 발화 유도 전략                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  TYPE A: 관심사 기반 업데이트                                        │   │
│  │                                                                      │   │
│  │  저장된 관심사 키워드 (Profile Layer)                                │   │
│  │       ↓                                                              │   │
│  │  정기적 웹 검색 (Tavily API)                                         │   │
│  │       ↓                                                              │   │
│  │  새로운 정보 감지                                                    │   │
│  │       ↓                                                              │   │
│  │  대화 시작 시 자연스럽게 제공                                         │   │
│  │                                                                      │   │
│  │  예시:                                                               │   │
│  │  "참, 관심 있으셨던 [AI 규제] 관련해서 오늘 새로운 소식이 있더라고요.│   │
│  │   EU에서 새 법안을 발표했대요. 혹시 들으셨어요?"                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  TYPE B: 상태/상황 기반 유사 정보                                    │   │
│  │                                                                      │   │
│  │  현재 감지된 상태 (피로, 스트레스, 고민...)                          │   │
│  │       ↓                                                              │   │
│  │  유사 상황 관련 정보 검색                                            │   │
│  │       ↓                                                              │   │
│  │  공감 + 정보 제공 형태로 발화                                        │   │
│  │                                                                      │   │
│  │  예시:                                                               │   │
│  │  "많이 피곤하신 것 같은데... 최근에 읽은 건데, 출퇴근 시간에          │   │
│  │   10분만 명상해도 피로 회복에 도움 된다고 하더라고요."                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  TYPE C: 의사결정 관련 정보                                          │   │
│  │                                                                      │   │
│  │  진행 중인 Decision (Pending)                                        │   │
│  │       ↓                                                              │   │
│  │  관련 정보 자동 수집 (시장 동향, 통계, 사례...)                       │   │
│  │       ↓                                                              │   │
│  │  결정에 도움되는 정보로 가공                                         │   │
│  │                                                                      │   │
│  │  예시:                                                               │   │
│  │  "이직 고민하신다고 하셨잖아요. 혹시 참고되실까 해서 찾아봤는데,      │   │
│  │   요즘 [IT 업계] 이직 시장이 어떤지 간단히 정리해봤어요."             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  TYPE D: 과거 대화 기반 후속 질문                                    │   │
│  │                                                                      │   │
│  │  과거 언급된 이벤트/약속 (RAG 검색)                                  │   │
│  │       ↓                                                              │   │
│  │  시간 경과 후 자연스럽게 물어보기                                     │   │
│  │                                                                      │   │
│  │  예시:                                                               │   │
│  │  "저번에 팀장님이랑 1:1 미팅 한다고 하셨는데, 어떻게 됐어요?"         │   │
│  │  "지난주에 말씀하신 프로젝트 발표는 잘 되셨어요?"                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 정보 수집 타이밍

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         정보 수집 타이밍                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  사전 수집 (Background)                                              │   │
│  │                                                                      │   │
│  │  • 매일 아침 6시: 관심사 키워드 기반 뉴스 검색                        │   │
│  │  • 세션 시작 1시간 전: 날씨, 교통 정보                               │   │
│  │  • Pending Decision 있을 시: 관련 정보 주기적 업데이트               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  실시간 수집 (On-demand)                                             │   │
│  │                                                                      │   │
│  │  • 사용자가 특정 주제 언급 시: 관련 정보 즉시 검색                    │   │
│  │  • "~에 대해 어떻게 생각해?" 질문 시: 관련 정보 제공                  │   │
│  │  • Q4 (WHAT DATA) 단계 진입 시: 필요 정보 자동 검색                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  후속 수집 (Follow-up)                                               │   │
│  │                                                                      │   │
│  │  • 세션 종료 후: 언급된 새 키워드 기반 정보 수집                      │   │
│  │  • Decision 업데이트 시: 관련 정보 갱신                              │   │
│  │  • 일정 기반: 언급된 날짜/이벤트 도래 시 알림                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 정보 제공 발화 패턴

| 상황 | 발화 패턴 | 예시 |
|------|----------|------|
| 관심사 업데이트 | "참, [주제] 관련해서..." | "참, AI 규제 관련해서 오늘 새 소식이 있더라고요" |
| 상태 기반 정보 | "혹시 도움이 될까 해서..." | "많이 피곤하신 것 같아서, 도움될 만한 거 하나 찾아봤어요" |
| 결정 관련 정보 | "생각하시는 거랑 관련해서..." | "이직 고민하신다고 하셨잖아요, 관련해서 찾아본 게 있어요" |
| 과거 대화 후속 | "저번에 말씀하신..." | "저번에 팀장님이랑 미팅 한다고 하셨는데, 어떻게 됐어요?" |
| 일정 리마인드 | "오늘 ~하신다고 했던 것 같은데..." | "오늘 발표 있으시다고 했던 것 같은데, 준비는 다 되셨어요?" |

---

## 4. OntologyRAG 타입 매핑

### 4.1 5가지 데이터 타입과 InCarCompanion 매핑

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    OntologyRAG 5 Types × InCarCompanion                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Object (모든 실체)                                                  │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  User          사용자 프로필, 성격, 가치관                           │   │
│  │  Session       대화 세션 (출근길/퇴근길)                             │   │
│  │  Decision      진행 중인 의사결정 (Pending/Active/Resolved)          │   │
│  │  Goal          사용자의 목표 (단기/장기)                             │   │
│  │  Constraint    사용자의 제약 조건                                    │   │
│  │  Person        언급된 사람 (동료, 가족, 친구)                        │   │
│  │  Topic         관심사/주제                                           │   │
│  │  Pattern       발견된 행동/감정 패턴                                 │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Relation (관계)                                                     │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  User → Session          PARTICIPATED                               │   │
│  │  Session → Utterance     HAS_UTTERANCE                              │   │
│  │  User → Decision         CONSIDERING                                │   │
│  │  Decision → Goal         AIMS_FOR                                   │   │
│  │  Decision → Constraint   LIMITED_BY                                 │   │
│  │  User → Person           RELATES_TO (type: colleague/family/friend) │   │
│  │  Decision → Person       INVOLVES                                   │   │
│  │  Topic → Topic           RELATED_TO                                 │   │
│  │  Pattern → User          OBSERVED_IN                                │   │
│  │  Utterance → Decision    MENTIONS                                   │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Event (시간 기반 발생)                                              │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  EmotionDetected     감정 감지 (type, intensity, trigger)            │   │
│  │  NeedIdentified      니즈 식별 (type, urgency)                       │   │
│  │  SilenceDetected     침묵 감지 (duration, context)                   │   │
│  │  TopicChanged        주제 변경                                       │   │
│  │  InsightGenerated    인사이트 생성                                   │   │
│  │  DecisionUpdated     의사결정 상태 변경                              │   │
│  │  BargeIn             사용자 끼어들기                                 │   │
│  │  SessionStarted      세션 시작                                       │   │
│  │  SessionEnded        세션 종료                                       │   │
│  │  ExternalInfoUsed    외부 정보 활용                                  │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Document (텍스트 - 검색용)                                          │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  Utterance           발화 transcript                                │   │
│  │  SessionSummary      세션 요약                                       │   │
│  │  DecisionContext     의사결정 맥락 설명                              │   │
│  │  InsightText         생성된 인사이트 텍스트                          │   │
│  │  ExternalInfo        수집된 외부 정보                                │   │
│  │  PatternDescription  패턴 설명                                       │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Vector (임베딩 - 자동 생성)                                         │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  Utterance embedding       유사 발화 검색용                          │   │
│  │  Decision embedding        유사 결정 상황 검색용                     │   │
│  │  Topic embedding           관련 주제 검색용                          │   │
│  │  ExternalInfo embedding    관련 외부 정보 검색용                     │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 구체적 매핑 예시

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         실제 대화 → Ontology 매핑 예시                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  사용자 발화: "오늘 회의에서 팀장이 짜증났어. 이직 고민이야."                │
│                                                                              │
│  ──────────────────────────────────────────────────────────────────────────│
│                                                                              │
│  Object 생성:                                                                │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ {                                                                   │    │
│  │   type: "Utterance",                                                │    │
│  │   id: "utt_001",                                                    │    │
│  │   text: "오늘 회의에서 팀장이 짜증났어. 이직 고민이야.",            │    │
│  │   speaker: "user",                                                  │    │
│  │   timestamp: "2025-12-06T18:30:00Z"                                 │    │
│  │ }                                                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ {                                                                   │    │
│  │   type: "Person",                                                   │    │
│  │   id: "person_team_leader",                                         │    │
│  │   name: "팀장",                                                     │    │
│  │   relationship: "supervisor"                                        │    │
│  │ }                                                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ {                                                                   │    │
│  │   type: "Decision",                                                 │    │
│  │   id: "dec_career_change",                                          │    │
│  │   status: "pending",                                                │    │
│  │   domain: "career",                                                 │    │
│  │   description: "이직 여부 결정"                                     │    │
│  │ }                                                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  Event 생성:                                                                 │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ {                                                                   │    │
│  │   type: "EmotionDetected",                                          │    │
│  │   id: "emo_001",                                                    │    │
│  │   object_id: "utt_001",                                             │    │
│  │   emotion: "frustration",                                           │    │
│  │   intensity: 0.7,                                                   │    │
│  │   surface_emotion: "anger",         // 표면 감정                    │    │
│  │   possible_root: "recognition_need" // Q1 탐색 대상                 │    │
│  │ }                                                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ {                                                                   │    │
│  │   type: "NeedIdentified",                                           │    │
│  │   id: "need_001",                                                   │    │
│  │   object_id: "utt_001",                                             │    │
│  │   need_type: "career_growth",                                       │    │
│  │   urgency: 0.6                                                      │    │
│  │ }                                                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  Relation 생성:                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ (user_001)-[:CONSIDERING]->(dec_career_change)                      │    │
│  │ (utt_001)-[:MENTIONS]->(dec_career_change)                          │    │
│  │ (utt_001)-[:MENTIONS]->(person_team_leader)                         │    │
│  │ (dec_career_change)-[:INVOLVES]->(person_team_leader)               │    │
│  │ (emo_001)-[:TRIGGERED_BY]->(person_team_leader)                     │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.3 Decision Entity 확장

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    Decision Entity (4 Core Questions 연계)                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  {                                                                           │
│    // 기본 정보                                                              │
│    id: "dec_career_change",                                                  │
│    type: "Decision",                                                         │
│    domain: "career",                                                         │
│    status: "pending",  // pending | active | resolved                        │
│    created_at: "2025-12-06T18:30:00Z",                                       │
│    updated_at: "2025-12-06T18:45:00Z",                                       │
│                                                                              │
│    // Q1: WHY (진짜 이유)                                                    │
│    surface_reason: "팀장에게 화가 남",                                       │
│    root_cause: "인정받지 못한다는 두려움",                                   │
│    root_cause_confidence: 0.7,                                               │
│    related_patterns: ["pat_recognition_need", "pat_authority_conflict"],     │
│                                                                              │
│    // Q2: WHAT DECISION (어떤 결정)                                          │
│    decision_question: "이직할지 말지",                                       │
│    options: [                                                                │
│      { id: "opt_stay", description: "현 회사 유지" },                        │
│      { id: "opt_leave", description: "이직" },                               │
│      { id: "opt_internal", description: "내부 이동" }                        │
│    ],                                                                        │
│    deadline: null,                                                           │
│    blockers: ["uncertainty_about_market", "financial_concern"],              │
│                                                                              │
│    // Q3: IMPACT (영향)                                                      │
│    impact_matrix: {                                                          │
│      emotional: { best: 3, likely: 1, worst: -2 },                           │
│      relational: { best: 2, likely: 0, worst: -3 },                          │
│      financial: { best: 4, likely: 2, worst: -1 },                           │
│      career: { best: 4, likely: 2, worst: -2 },                              │
│      psychological: { best: 3, likely: 0, worst: -4 }                        │
│    },                                                                        │
│                                                                              │
│    // Q4: WHAT DATA (필요한 정보)                                            │
│    required_data: [                                                          │
│      { type: "market_trend", status: "collected", source: "web" },           │
│      { type: "team_feedback", status: "pending", source: "user" },           │
│      { type: "salary_comparison", status: "not_started", source: "web" }     │
│    ],                                                                        │
│    collected_external_info: ["ext_001", "ext_002"],                          │
│                                                                              │
│    // 연결된 대화들                                                          │
│    related_utterances: ["utt_001", "utt_015", "utt_032"],                    │
│    related_sessions: ["sess_001", "sess_005"],                               │
│    involved_persons: ["person_team_leader", "person_spouse"]                 │
│  }                                                                           │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 3-Layer 대화 엔진 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    Personal Ontology Building Engine                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                         SURFACE LAYER                                 │   │
│  │                      (표면 대화 - 현재 구현)                           │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  입력기 → 감정확장 → 자유발화 → 정적 → 재자극                         │   │
│  │                                                                       │   │
│  │  + 외부 정보 기반 대화 시작                                           │   │
│  │    • 관심사 업데이트                                                  │   │
│  │    • 과거 대화 후속 질문                                              │   │
│  │    • Pending Decision 관련 정보                                       │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                              │                                               │
│                              │ 깊이 신호 감지                                │
│                              ▼                                               │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                         DEPTH LAYER (NEW)                             │   │
│  │                      (깊이 탐색 - 4 Core Questions)                   │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │                                                                       │   │
│  │   UNCOVER       CRYSTALLIZE      MEASURE         CONNECT             │   │
│  │   (발굴)         (결정화)         (측정)          (연결)              │   │
│  │     │              │               │               │                  │   │
│  │     ▼              ▼               ▼               ▼                  │   │
│  │   Q1.WHY        Q2.DECISION     Q3.IMPACT      Q4.DATA               │   │
│  │   진짜 이유      어떤 결정        영향 범위       필요 정보            │   │
│  │     │              │               │               │                  │   │
│  │     ▼              ▼               ▼               ▼                  │   │
│  │   [Pattern       [Decision       [Impact        [External            │   │
│  │    Object]        Object]         Event]         Info]               │   │
│  │                                                                       │   │
│  │   → OntologyRAG에 저장                                                │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                              │                                               │
│                              │ 구조화 완료                                   │
│                              ▼                                               │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                        INSIGHT LAYER (NEW)                            │   │
│  │                      (인사이트 생성 - Output)                          │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │                                                                       │   │
│  │  Input:                                                               │   │
│  │  ┌────────────────────────────────────────────────────────────────┐  │   │
│  │  │ Q1 + Q2 + Q3 + Q4 결과                                         │  │   │
│  │  │ + 수집된 외부 정보                                             │  │   │
│  │  │ + 현재 컨텍스트 (시간, 위치, 상태)                             │  │   │
│  │  │ + 과거 유사 상황 (RAG 검색)                                    │  │   │
│  │  └────────────────────────────────────────────────────────────────┘  │   │
│  │                              │                                        │   │
│  │                              ▼                                        │   │
│  │  Output:                                                              │   │
│  │  ┌────────────────────────────────────────────────────────────────┐  │   │
│  │  │ "지금은 [상황] 이고,                                           │  │   │
│  │  │  [정보/이유] 때문에,                                           │  │   │
│  │  │  [목적]을 위해서,                                              │  │   │
│  │  │  지금은 [행동 가이드]가 좋을 것 같아요"                        │  │   │
│  │  └────────────────────────────────────────────────────────────────┘  │   │
│  │                              │                                        │   │
│  │                              ▼                                        │   │
│  │  저장: InsightGenerated Event + InsightText Document                 │   │
│  │                                                                       │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. DEPTH LAYER 상세 설계

### Phase 1: UNCOVER (발굴) - Q1. WHY

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  목적: 표면 감정 뒤의 진짜 감정/이유 발굴                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  표면: "오늘 회의에서 팀장이 너무 짜증났어"                                   │
│           │                                                                  │
│           │ 부드러운 탐색                                                    │
│           ▼                                                                  │
│  레벨1: "회의에서 뭔가 불편했던 거 같네요... 어떤 부분이 제일 마음에 걸려요?" │
│           │                                                                  │
│           ▼                                                                  │
│  레벨2: "혹시 비슷한 느낌 받았던 적 있어요? 언제였는지 기억나요?"             │
│           │                                                                  │
│           ▼                                                                  │
│  진짜:  "사실 화가 난 게 아니라... 내 의견이 무시당한 것 같아서 서러웠어"     │
│                                                                              │
│  ──────────────────────────────────────────────────────────────────────────│
│                                                                              │
│  Ontology 저장:                                                              │
│  • Event: EmotionDetected (surface + possible_root)                          │
│  • Object: Pattern (if recurring pattern found)                              │
│  • Relation: Pattern -[OBSERVED_IN]-> User                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

**자연스러운 질문 기법:**

| 기법 | 직접 질문 | 자연스러운 질문 |
|------|----------|----------------|
| 반영 | "왜 그렇게 생각해요?" | "~라고 느끼신 거네요... 그 느낌이 어디서 오는 것 같아요?" |
| 신체 감각 | "진짜 감정이 뭐예요?" | "그 생각하면 몸 어디가 반응해요? 가슴? 배?" |
| 시간 확장 | "과거랑 관련 있어요?" | "비슷한 느낌 받았던 적 있어요?" |

---

### Phase 2: CRYSTALLIZE (결정화) - Q2. WHAT DECISION

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  목적: 흐릿한 고민을 구체적 의사결정 문제로 결정화                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  흐릿함: "요즘 좀 그래... 뭔가 잘 모르겠어"                                  │
│            │                                                                 │
│            │ 결정화 질문                                                     │
│            ▼                                                                 │
│  구체화1: "만약 지금 뭔가 하나만 바꿀 수 있다면, 뭘 바꾸고 싶어요?"           │
│            │                                                                 │
│            ▼                                                                 │
│  구체화2: "그걸 안 하고 있는 이유가 있을까요?"                               │
│            │                                                                 │
│            ▼                                                                 │
│  결정:   "이직할지 말지 결정을 해야 하는데... 미루고 있었네"                  │
│                                                                              │
│  ──────────────────────────────────────────────────────────────────────────│
│                                                                              │
│  Ontology 저장:                                                              │
│  • Object: Decision (status: pending, options[], blockers[])                 │
│  • Relation: User -[CONSIDERING]-> Decision                                  │
│  • Relation: Decision -[LIMITED_BY]-> Constraint                             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Phase 3: MEASURE (측정) - Q3. IMPACT

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  목적: 결정의 다차원적 영향을 구체화/측정                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  차원별 질문:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  감정적      "그렇게 되면 마음이 어떨 것 같아요?"                    │   │
│  │  관계적      "주변 사람들은 어떻게 반응할까요?"                      │   │
│  │  커리어      "커리어에는 어떤 영향이?"                               │   │
│  │  금전적      "경제적으로는 어떻게 될까요?"                           │   │
│  │  심리적      "오랫동안 마음에 남을 것 같은 부분은?"                  │   │
│  │  숨겨진      "혹시 말하기 좀 그런 영향도 있어요?"                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  시나리오:                                                                   │
│  • Best Case: "가장 잘 됐을 때 어떤 모습이에요?"                            │
│  • Worst Case: "최악의 경우는 뭘까요?"                                      │
│  • Most Likely: "현실적으로는 어떻게 될 것 같아요?"                         │
│                                                                              │
│  ──────────────────────────────────────────────────────────────────────────│
│                                                                              │
│  Ontology 저장:                                                              │
│  • Decision.impact_matrix 업데이트                                           │
│  • Event: 각 차원별 영향 평가 기록                                           │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

### Phase 4: CONNECT (연결) - Q4. WHAT DATA

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  목적: 의사결정에 필요한 정보/데이터 식별 및 연결                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  정보 유형:                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  외부 정보    시장 동향, 통계, 전문가 의견 → 웹 검색                 │   │
│  │  과거 경험    "예전에 비슷한 결정 했을 때 어땠어요?" → RAG 검색      │   │
│  │  타인 경험    "주변에 비슷한 경험 한 사람 있어요?"                   │   │
│  │  내면 정보    가치관, 트라우마, 무의식적 믿음 → Q1 결과 참조         │   │
│  │  잊은 정보    "예전에 읽었던/들었던 거 중에..." → RAG 검색           │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  연결 발견:                                                                  │
│  • "이거랑 예전에 말씀하셨던 [X]가 연결되는 것 같은데..."                   │
│  • "어릴 때 경험이 지금 결정에 영향을 주는 것 같아요"                       │
│  • "회사 문제라고 했는데, 혹시 가족 관계랑 비슷한 패턴 있어요?"             │
│                                                                              │
│  ──────────────────────────────────────────────────────────────────────────│
│                                                                              │
│  Ontology 저장:                                                              │
│  • Decision.required_data[] 업데이트                                         │
│  • Object: ExternalInfo (수집된 외부 정보)                                   │
│  • Relation: Decision -[NEEDS]-> DataRequirement                            │
│  • Relation: Utterance -[RELATES_TO]-> 과거 Utterance (RAG 검색 결과)       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 인사이트 생성 예시

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Input (수집된 정보):                                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│  Q1 Result: 진짜 감정 = "인정받지 못한다는 두려움"                           │
│  Q2 Result: 결정 = "이직 여부"                                               │
│  Q3 Result: Impact = {감정: +2, 관계: -1, 금전: +3, 커리어: +3}              │
│  Q4 Result: 필요 정보 = "현 회사 성장 가능성, 이직 시장 현황"                │
│                                                                              │
│  External Info:                                                              │
│  • "2025년 IT 업계 이직 시장 활발, 시니어 개발자 수요 증가"                  │
│  • "현 회사 작년 대비 매출 15% 감소, 구조조정 루머"                          │
│                                                                              │
│  Context: 퇴근길, 오후 7시, 피곤한 상태                                      │
│                                                                              │
│  Past Similar: 2년 전 비슷한 고민 → 결국 안 옮기고 후회                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  Output (인사이트):                                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  "오늘 회의 얘기 들으면서 느낀 건데요,                                       │
│                                                                              │
│   [상황 정리]:                                                               │
│   팀장님 때문에 화가 났다고 하셨는데, 사실은 내 의견이                       │
│   인정받지 못한다는 느낌이 더 크셨던 것 같아요.                              │
│   2년 전에도 비슷한 고민하셨던 것 같은데, 그때는 결국                        │
│   안 옮기셨다고 하셨잖아요.                                                  │
│                                                                              │
│   [정보 공유]:                                                               │
│   찾아보니까 요즘 IT 업계 이직 시장이 꽤 활발하더라고요.                     │
│   특히 시니어분들 수요가 많대요.                                             │
│                                                                              │
│   [행동 가이드]:                                                             │
│   오늘은 좀 피곤하시니까, 이번 주 안에 한 가지만 해보시면                    │
│   어떨까요? 팀장님이랑 1:1로 커리어 얘기 한번 해보시는 거요.                 │
│   그 반응 보시고 판단해도 늦지 않을 것 같아요.                               │
│                                                                              │
│   다음에 또 얘기해요. 오늘 수고하셨어요."                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 데이터 흐름 전체 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      InCarCompanion ↔ OntologyRAG 연동                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                        InCarCompanion (Client)                         │ │
│  │                                                                        │ │
│  │   VoiceChat Engine                                                     │ │
│  │   ┌──────────────────────────────────────────────────────────────┐   │ │
│  │   │  Surface Layer → Depth Layer → Insight Layer                  │   │ │
│  │   └──────────────────────────────────────────────────────────────┘   │ │
│  │           │                                                           │ │
│  │           ▼                                                           │ │
│  │   ┌──────────────────────────────────────────────────────────────┐   │ │
│  │   │  Local Processing:                                            │   │ │
│  │   │  • Gemini Live API (실시간 음성)                              │   │ │
│  │   │  • VAD (Voice Activity Detection)                             │   │ │
│  │   │  • 감정 감지                                                  │   │ │
│  │   └──────────────────────────────────────────────────────────────┘   │ │
│  │                                                                        │ │
│  └────────────────────────────────────┬──────────────────────────────────┘ │
│                                       │                                     │
│                                       │ API Calls (google_sub 포함)        │
│                                       ▼                                     │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                          OntologyRAG (Server)                          │ │
│  │                                                                        │ │
│  │   ┌────────────────┐  ┌────────────────┐  ┌────────────────┐         │ │
│  │   │   Postgres     │  │    Neo4j       │  │   pgvector     │         │ │
│  │   │  (Objects,     │  │  (Graphs,      │  │  (Embeddings,  │         │ │
│  │   │   Events)      │  │   Relations)   │  │   Similar)     │         │ │
│  │   └────────────────┘  └────────────────┘  └────────────────┘         │ │
│  │                                                                        │ │
│  │   저장되는 데이터:                                                     │ │
│  │   • Object: User, Session, Decision, Person, Topic, Pattern           │ │
│  │   • Relation: 모든 연결 관계                                          │ │
│  │   • Event: Emotion, Need, Silence, Insight 등                         │ │
│  │   • Document: Utterance, Summary, ExternalInfo                        │ │
│  │   • Vector: 모든 텍스트의 임베딩                                      │ │
│  │                                                                        │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                       External Data Sources                            │ │
│  │                                                                        │ │
│  │   ┌────────────────┐  ┌────────────────┐  ┌────────────────┐         │ │
│  │   │  Tavily API    │  │  Weather API   │  │  SookIntel     │         │ │
│  │   │  (웹 검색)     │  │  (날씨)        │  │  (개인 문서)   │         │ │
│  │   └────────────────┘  └────────────────┘  └────────────────┘         │ │
│  │                                                                        │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. 논의 포인트

### 9.1 진입 조건
- Surface → Depth 진입 신호:
  - 감정 강도 높음 (emotion_level > 0.8)
  - "모르겠어", "고민이야", "어떻게 해야 할지" 키워드
  - 같은 주제 3회 이상 반복
  - 회피 패턴 감지

### 9.2 질문 순서
- Q1→Q2→Q3→Q4 순차적 진행이 기본
- 상황에 따라:
  - Q2가 이미 명확하면 Q1 먼저 탐색
  - Q4가 급하면 바로 정보 수집 후 다른 Q로

### 9.3 외부 정보 활용 타이밍
- 대화 시작 시: 관심사 업데이트, 과거 후속 질문
- Q4 단계: 필요 정보 자동 검색
- 인사이트 생성 시: 맥락 보강

### 9.4 인사이트 제공 타이밍
- 세션 종료 시: 전체 요약 + 행동 가이드
- Depth 완료 시: 중간 인사이트
- 다음 세션 시작 시: 이전 인사이트 후속

---

## 10. 다음 단계

1. **Phase 구현**: 새로운 Depth/Insight Layer Phase 정의
2. **Ontology API 연동**: Decision, Pattern 등 새 Object 타입 추가
3. **외부 정보 수집**: Background job으로 관심사 기반 정보 수집
4. **인사이트 템플릿**: LLM 프롬프트로 인사이트 생성 구조화

---

*Last Updated: 2025-12-06 v2.0*
