# SoleTalk Rails Build Plan

## Status
- [x] P1-T1 OntologyRag::Client initializes required headers (`X-API-Key`, `X-Source-App`, `X-Request-ID`)
- [x] P1-T2 OntologyRag::Client raises configuration error when required env vars are missing
- [x] P1-T3 OntologyRag::Client identify_user posts to `/engine/users/identify` with `google_sub`
- [x] P1-T4 OntologyRag::Client query posts to `/engine/query` and normalizes response
- [x] P1-T5 OntologyRag::Client handles timeout/retry/fallback policy
- [x] P2-T1 OntologyRag::Client get_prompts requests `/engine/prompts/{google_sub}`
- [x] P2-T2 OntologyRag::Client record_events posts to `/incar/events/batch`
- [x] P2-T3 OntologyRag::Client save_conversation posts to `/incar/conversations/{session_id}/save`
- [x] P3-T1 DepthExploration validates signal range and required Q1~Q4 shape
- [x] P3-T2 Insight maps Q1~Q4 fields (`situation`, `decision`, `action_guide`, `data_info`)
- [x] P3-T3 DepthExploration/Insight JSON fields are persisted safely with defaults
- [x] P4-T1 UserSyncService identifies user and returns standardized success payload
- [x] P4-T2 UserSyncService returns standardized error payload on failed upstream response
- [x] P5-T1 POST /api/ontology_rag/users/sync returns success payload
- [x] P5-T2 POST /api/ontology_rag/users/sync returns 422 when google_sub missing
- [x] P5-T3 POST /api/ontology_rag/users/sync returns 502 on upstream failure
- [x] P6-T1 OntologyRag::Constants defines P0 endpoint paths and timeout policy
- [x] P6-T2 OntologyRag::Models::EngcProfile keeps singular ENGC keys only
- [x] P6-T3 OntologyRag::Models::QueryResponse normalizes nil sources to empty array
- [x] P7-T1 User validates google_sub presence/uniqueness
- [x] P7-T2 Auth::GoogleSubExtractor extracts google_sub from omniauth auth hash
- [x] P8-T1 Session belongs_to user and validates status
- [x] P8-T2 Message belongs_to session and validates role enum
- [x] P8-T3 VoiceChatData/Setting belong_to user or session with JSON defaults
- [x] P9-T1 authenticate_user! redirects when session is missing
- [x] P9-T2 OmniAuth callback creates user and signs in session
- [x] P9-T3 OmniAuth failure redirects safely
- [x] P10-T1 OmniAuth initializer registers google_oauth2 provider config
- [x] P10-T2 IdentifyUserJob calls UserSyncService with google_sub
- [x] P10-T3 OmniAuth callback enqueues IdentifyUserJob
- [x] P11-T1 OntologyRag::Client default adapter uses Faraday request path
- [x] P11-T2 OntologyRag::Client fallback handles Faraday timeout errors
- [x] P12-T1 VoiceChat::Constants defines 5-phase sequence and depth trigger thresholds
- [x] P12-T2 VoiceChat::DepthSignalDetector detects high emotion/repetition/keywords
- [x] P12-T3 VoiceChat::PhaseTransitionEngine moves opener->emotion_expansion based on emotion
- [x] P13-T1 VoiceChat::EmotionTracker updates and clamps emotion/energy levels
- [x] P13-T2 VoiceChat::NarrowingService generates progressively focused questions
- [x] P14-T1 VoiceChat::QuestionGenerator provides Q1~Q4 prompts
- [x] P14-T2 VoiceChat::DepthManager tracks depth progress and completion
- [x] P15-T1 VoiceChat::DepthExplorationService records q1~q4 answers to DepthExploration
- [x] P15-T2 VoiceChat::ImpactAnalyzer returns 5-dimension impact summary
- [x] P15-T3 VoiceChat::InformationNeedManager classifies info needs by type
- [x] P16-T1 VoiceChat::ContextOrchestrator builds 5-layer context payload
- [x] P16-T2 VoiceChat::TokenBudgetManager allocates token budget by layer ratio
- [x] P17-T1 Insight::NaturalSpeech formats situation/decision/action/data into sentence
- [x] P17-T2 Insight::Generator creates Insight record from depth answers
- [x] P18-T1 GET /insights returns ordered insight list
- [x] P18-T2 GET /insights/:id renders selected insight
- [x] P19-T1 ContextOrchestrator caches profile/past_memory/additional_info/ai_persona with layer-specific TTL
- [x] P19-T2 ContextOrchestrator does not cache current_session layer
- [x] P19-T3 ContextOrchestrator reuses cache key scope by google_sub/session_id
- [x] P20-T1 VoiceChatChannel subscribes only when session_id is present
- [x] P20-T2 VoiceChatChannel streams/broadcasts messages on per-session stream
- [x] P20-T3 Mount ActionCable endpoint for real-time transport
- [x] P21-T1 PhaseTransitionBroadcaster publishes Turbo Stream update for session phase badge
- [x] P21-T2 VoiceChatChannel replay returns missed messages and current phase snapshot
- [x] P21-T3 VoiceChatChannel rejects subscription for unknown session
- [x] P22-T1 GET /sessions renders current user's sessions list
- [x] P22-T2 GET /sessions/:id renders voice chat page with turbo_stream_from session
- [x] P22-T3 Session show includes phase badge target for Turbo replacement
- [x] P23-T1 Session show renders message stream in chronological order
- [x] P23-T2 POST /sessions/:session_id/messages creates user message
- [x] P23-T3 POST /sessions/:session_id/messages rejects access to other user's session
- [x] P24-T1 GET /sessions/new renders new session form
- [x] P24-T2 POST /sessions creates active session and initializes voice_chat_data
- [x] P24-T3 Sessions index exposes new session entry point
- [x] P25-T1 GET /insights renders card-based timeline list
- [x] P25-T2 GET /insights/:id renders Q1~Q4 detail cards
- [x] P25-T3 Session show renders DEPTH panel and recent insights panel
- [x] P26-T1 GET /setting renders current user setting form
- [x] P26-T2 PATCH /setting updates language/voice_speed/preferences
- [x] P26-T3 Sessions and setting screens cross-link navigation
- [x] P27-T1 Session show renders emotion gauge with current emotion value
- [x] P27-T2 Emotion gauge renders fallback 0.0 when voice_chat_data absent
- [x] P28-T1 Setting form includes Stimulus controller hook
- [x] P28-T2 Session message form includes Stimulus controller hook
- [x] P28-T3 Importmap + Stimulus bootstrap files are wired in layout
- [x] P29-T1 EngcEventBatchJob sends events to OntologyRag::Client#record_events
- [x] P29-T2 ConversationSaveJob sends session transcript to OntologyRag::Client#save_conversation
- [x] P29-T3 Background jobs apply retry policy (3 attempts)
- [x] P30-T1 ExternalInfoJob skips collection for free tier users
- [x] P30-T2 ExternalInfoJob queries OntologyRag for premium users with Type A-D requests
- [x] P30-T3 ExternalInfoJob applies retry policy (3 attempts)
- [x] P31-T1 DeadLetterNotifier records discarded job payloads
- [x] P31-T2 Background jobs register after_discard dead-letter callback
- [x] P31-T3 Admin job dashboard exposes failed/dead-letter summary
- [x] P32-T1 User subscription fields/status support premium predicate
- [x] P32-T2 Subscription::EntitlementChecker gates premium-only features
- [x] P32-T3 RevenueCat webhook updates user subscription state
- [x] P33-T1 Subscription::FeatureGate computes daily session quota by tier
- [x] P33-T2 Subscription::FeatureGate enforces 7-day history for free tier
- [x] P33-T3 InsightsController blocks free users and allows premium users
- [x] P34-T1 RevenueCatClient validates required env configuration
- [x] P34-T2 RevenueCatClient normalizes subscriber entitlement payload
- [x] P34-T3 Subscription sync service updates user status from RevenueCat payload
- [x] P35-T1 GET /subscription renders paywall UI
- [x] P35-T2 POST /subscription/validate performs server-side sync and updates user
- [x] P35-T3 Premium users see manage-subscription state on paywall page
- [x] P36-T1 Voice::BridgeMessage validates allowed native bridge actions
- [x] P36-T2 POST /api/voice/events processes transcription into session messages
- [x] P36-T3 Session page exposes native bridge hook attributes
- [x] P37-T1 OntologyRag::Constants defines get_cached_profile endpoint
- [x] P37-T2 OntologyRag::Client#get_cached_profile requests /incar/profile/{google_sub}
- [x] P37-T3 get_cached_profile returns normalized hash payload
- [x] P38-T1 POST /api/voice_chat/surface returns next phase payload
- [x] P38-T2 POST /api/voice_chat/depth persists depth exploration answers
- [x] P38-T3 POST /api/voice_chat/insight creates insight from depth answers
- [x] P39-T1 OntologyRag::Client#query caches identical requests
- [x] P39-T2 cached query entry expires after configured TTL
- [x] P39-T3 query caching key includes google_sub and question
- [x] P40-T1 POST /api/ontology_rag/query validates required question param
- [x] P40-T2 POST /api/ontology_rag/query returns normalized query response
- [x] P40-T3 POST /api/ontology_rag/query propagates upstream error as 502
- [x] P41-T1 ContextOrchestrator builds L2 past_memory via OntologyRag query
- [x] P41-T2 ContextOrchestrator builds L4 additional_info via OntologyRag query
- [x] P41-T3 ContextOrchestrator builds profile layer from cached profile endpoint
- [x] P42-T1 E2E SURFACE->DEPTH->INSIGHT flow succeeds via API endpoints
- [x] P42-T2 E2E Auth->Chat->Insight->Save flow persists conversation and insight
- [x] P42-T3 E2E free-tier gating blocks insight access while premium allows
- [x] P43-T1 E2E ontology query upstream timeout returns 502 with error payload
- [x] P43-T2 E2E voice transcription validation rejects empty payload
- [x] P43-T3 E2E subscription webhook handles unknown user with 404
- [x] P44-T1 Security gate: Brakeman report reviewed with no new high-risk findings
- [x] P44-T2 Quality gate: full test suite and RuboCop clean
- [x] P44-T3 Performance smoke: key API endpoint p95 baseline captured
- [x] P45-T1 GET /healthz returns app/db status payload
- [x] P45-T2 EnvValidator reports missing required production env vars
- [x] P45-T3 Health payload includes timestamp and version marker
- [x] P46-T1 API unexpected exception returns standardized 500 payload with request_id
- [x] P46-T2 ActiveRecord::RecordNotFound returns standardized 404 payload
- [x] P46-T3 ErrorReporter receives exception/context for API failures
- [x] P47-T1 CI workflow includes Docker image build smoke step
- [x] P47-T2 CI pipeline keeps test/security/lint gates before build
- [x] P47-T3 CI baseline documented in deployment progress doc
- [x] P48-T1 Ops::PreflightCheck validates required env and deployment artifacts
- [x] P48-T2 rake ops:preflight exposes machine-readable preflight summary
- [x] P48-T3 Preflight check returns non-ok when critical files are missing
- [x] P49-T1 Railway platform selected and deployment config file added
- [x] P49-T2 Preflight validates Railway artifact presence
- [x] P49-T3 Railway deployment baseline documented in ondev docs
- [x] P50-T1 Railway `SECRET_KEY_BASE` 주입 후 재배포 성공
- [x] P50-T2 Railway production `/healthz`가 `ok: true`, `database: ok` 반환
- [x] P50-T3 Railway production root endpoint (`/`)가 200 응답
- [x] P51-T1 Railway에 `ONTOLOGY_RAG_BASE_URL`, `ONTOLOGY_RAG_API_KEY` 실운영 값 주입
- [x] P51-T2 Railway에 `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET` 실운영 값 주입
- [x] P51-T3 `ops:preflight`/`/healthz` 기준으로 운영 ENV 최종 검증 완료
- [x] P52-T1 Phase16 운영 runbook 문서화 완료
- [x] P52-T2 App Store 준비 체크리스트 문서화 완료
- [x] P53-T1 Post-ENV workflow gate verification 문서화 완료
- [x] P53-T3 모바일 네이티브 트랙(Phase13 잔여) 별도 실행 계획 확정
- External Gate-A (Manual/Out-of-Repo): App Store checklist Remaining 항목은 `docs/ondev/20260214_25_app_store_prep_checklist.md`에서 추적
- External Gate-B (Manual/Out-of-Repo): 스토어 메타/정책/제출 아티팩트는 모바일 트랙 완료 후 순차 진행
- [x] P54-T1 루트(`/`) 비로그인 화면에 Google OAuth 진입 UI 제공
- [x] P54-T2 루트(`/`) 로그인 화면에 세션/인사이트 진입 대시보드 제공
- [x] P54-T3 홈 통합 테스트 추가 및 통과 (`home_flow_test`)
- [x] P55-T1 Voice::EventProcessor에 `start/stop/location` 액션별 persistence + validation 추가
- [x] P55-T2 `POST /api/voice/events`에 세션 소유권/인증 가드 강화
- [x] P55-T3 Voice 이벤트 E2E(start->transcription->stop + location, failure path) 테스트 보강
- [x] P56-T1 `location_update` 위/경도 범위 검증 추가 (`-90..90`, `-180..180`)
- [x] P57-T1 Android-first 실행계획 문서화 및 모바일 핸드오프 계획 동기화
- [x] P57-T2 Android Hotwire Native PoC 착수 (로컬 `mobile/android` 스캐폴드)
- [x] P57-T3 Android Bridge 계약 검증: start/stop/transcription/location 이벤트 E2E 완료 (`test/integration/e2e_voicechat_flow_test.rb`)
- [x] P58-T1 iOS 트랙은 `Deferred`로 유지 (실기기 부재)
- [x] P58-T2 iOS 실기기 부재 대체검증(시뮬레이터/API contract/외부테스터) 계획 확정 (`docs/ondev/20260215_01_ios_deferred_validation_plan.md`)
- [x] P59-T1 `POST /api/auth/google/native_sign_in` Android 네이티브 로그인 엔드포인트 추가
- [x] P59-T2 `Auth::GoogleIdTokenVerifier`로 Google ID Token 검증(aud/iss/sub) 추가
- [x] P59-T3 native sign-in 성공 시 `google_sub` 사용자 upsert + 세션 로그인 + IdentifyUserJob enqueue
- [x] P60-T1 Session 화면에서 `SoleTalkBridge.setSession(session_id, google_sub)` 자동 주입
- [x] P61-T1 `Auth::VoiceBridgeToken` 서명 토큰 발급/검증 추가
- [x] P61-T2 Session show에서 bridge token 주입 및 Android bridge 3-arg 세션 연결 지원
- [x] P61-T3 `/api/voice/events` bridge_token 인증 허용(세션/사용자 매칭 검증)
- [x] P62-T1 홈/공통 레이아웃 UX 하드닝: 개인정보 노출 문구 제거 + 공통 내비게이션/플래시 피드백 추가
- [x] P62-T2 세션 UX 하드닝: Android 브리지 도구를 디버그 섹션(`details`)으로 분리 + 상태 live region 추가
- [x] P62-T3 폼 UX 하드닝: 메시지 전송 버튼 상태 변화 + settings JSON 유효성 안내 + CTA 스타일 통일
- [x] P63-T1 `POST /sessions`는 Session/VoiceChatData 생성을 트랜잭션으로 처리하고 초기화 실패 시 롤백 + 경고 피드백 제공
- [x] P63-T2 `PATCH /setting`은 invalid `preferences_json` 입력 시 기존 preferences를 보존하고 alert를 제공
- [x] P63-T3 message form submit 버튼 복귀 라벨은 하드코딩 대신 `data-default-label` 메타데이터를 사용
- [x] P64-T1 Insight 접근/노출을 사용자 소유 범위로 격리하도록 `Insight` 소유 모델링(`user_id` 또는 `session_id`)과 컨트롤러 스코프를 정합화
- [x] P65-T1 `ApplicationController` locale 선택 로직 추가: 요청 파라미터(`?locale=ko/en`) + 사용자 `Setting.language` 우선순위 적용
- [x] P65-T2 Home/Sessions/Insights/Settings/Subscription + 공통 네비 문구를 i18n 키(`en/ko`) 기반으로 치환
- [x] P65-T3 주요 flash 메시지(i18n)와 locale 회귀 통합 테스트(`test/integration/i18n_flow_test.rb`) 추가/통과
- [x] P66-T1 Node 내장 테스트 러너 기반 Stimulus unit 테스트 실행 경로 구축 (`package.json`, loader/mock)
- [x] P66-T2 `message_form`, `settings_form`, `native_bridge` 컨트롤러 단위 테스트 추가 (`test/javascript/controllers/*`)
- [x] P66-T3 `npm run test:js` + Rails 전체 테스트 green으로 JS/Rails 회귀 게이트 통과
- [x] P67-T1 Android 외부 게이트 로그 자동집계 스크립트 추가 (`script/mobile/collect_voicebridge_evidence.sh`)
- [x] P67-T2 실기기 체크리스트 문서에 스크립트 실행 경로/증적 포맷 연동 (`docs/ondev/20260214_38_phase13_p57_t3_device_e2e_checklist.md`)
- [x] P67-T3 스크립트 스모크 실행으로 동작 확인(현재는 액션 미수행 상태라 expected fail: `missing` 4건)
- [x] P68-T1 Android OAuth 시작점을 `/auth/google_oauth2/start`로 분리하고 `mobile_return` handoff 저장/복구 경로 추가
- [x] P68-T2 `soletalk://auth` 딥링크 + `/api/auth/google/mobile_handoff` 세션 교환으로 WebView 로그인 복귀 구현
- [x] P68-T3 OAuth handoff 회귀 테스트/Android 빌드 검증 완료 (`auth_flow_test`, `google_controller_test`, `mobile_session_handoff_token_test`, `assembleDebug`)
- [x] P69-T1 Core UX Motion: Project_B 스타일 별 입자 애니메이션(집합→확산→구형 재집합) 프로토타입 구현
- [x] P69-T2 Core UX Motion: 모바일 성능 가드레일(FPS/배터리) + 감쇠 파라미터 튜닝
- [x] P69-T3 Core UX Motion: 세션 phase/opener 상태 연동 및 UX 회귀 테스트 추가
- [x] P70-T1 Core UX Motion parsing hardening: phase badge 감정값이 라벨 포함 문자열이어도 숫자 파싱 유지 (`extractFirstNumber`, JS unit test)
- [x] P70-T2 Core UX Motion visibility polish: phase별 렌더 팔레트 + 모바일 가시성(halo/core/background) 튜닝 + orb fallback texture
- [x] P70-T3 Android OAuth return race fix: deep-link intent 수신 시 fallback reload 경합 차단 (`MainActivity#onNewIntent`) + `assembleDebug` 검증
- [x] P71-T1 Subscription UX: free 사용자 대상 소비자 안내형 paywall(요금제 가치 요약 + 복원 섹션)으로 화면 개편
- [x] P71-T2 Subscription validate error path: RevenueCat ID 미입력/미보유 시 성공 플래시 대신 alert 노출
- [x] P71-T3 Subscription validate reuse path: 입력값 비어 있어도 저장된 `revenue_cat_id`로 복원 검증 가능
- [x] P72-T1 Frontend overhaul baseline: InCar 레퍼런스(Project_A_02_InCar.zip) 기반 전역 shell(`app-shell`), glass nav, dark aurora 배경 테마 적용
- [x] P72-T2 Home/session visual refresh: home orb stage 전용 클래스(`orb-hero-home`) + session 대화 스택 컨테이너(`conversation-stack`) 도입
- [x] P72-T3 Motion palette alignment: particle orb phase 색상 팔레트를 Project_B/InCar 블루-퍼플 계열로 재조정
- [x] P73-T1 Local-first workflow: dev/test 전용 `POST /dev/sign_in`, `DELETE /dev/sign_out` 추가로 모바일 UI 로컬 로그인 루프 지원
- [x] P73-T2 Android debug base URL 분리: `BuildConfig.WEB_BASE_URL` + `SOLETALK_DEBUG_BASE_URL` gradle property 주입
- [x] P73-T3 로컬 실행 자동화: `script/mobile/start_local_ui_workflow.sh`(adb reverse + installDebug) 추가 및 전체 회귀/Android 빌드 검증
- [x] P74-T1 Subscription validate 설정 누락 경로에서 500 대신 사용자 alert 경로로 처리 (`SubscriptionController` rescue + integration test)
- [x] P74-T2 Action Cable production adapter를 `solid_cable`로 정합화 (`config/cable.yml`)
- [x] P74-T3 `/subscription/validate` CSRF invalid 경로가 500이 아닌 제어된 응답(422 또는 redirect)으로 처리되도록 수정/검증
- [x] P74-T4 Railway production smoke에서 `/subscription/validate` non-500 및 로그 증적 확인
- [x] P75-T1 Roadmap sync baseline: 현재 실행 작업을 `plan.md`/sub-plan/gap 문서에 동기화
- [x] P76-T1 Railway RevenueCat ENV 존재 여부 점검 (`REVENUECAT_BASE_URL`, `REVENUECAT_API_KEY` 미설정 확인)
- [x] P76-T2a Railway `REVENUECAT_BASE_URL=https://api.revenuecat.com` 주입
- [x] P76-T2b Railway `REVENUECAT_API_KEY` 운영값 주입
- [x] P76-T3a 운영 서버측 smoke: `RevenueCatClient` 초기화 및 `Subscription::SyncService` 실행 검증 (`railway run`)
- [x] P76-T3b 로그인 사용자 기준 `/subscription/validate` 실운영 end-to-end(restore/validate) smoke 증적 확보 (request_id `80aca412-77e5-4e1f-bba6-440e3023c2cb`, `302`)
- [x] P77-T1 Project_B 기준 Playwright user journey audit 스크립트 저장소 고정 (`script/playwright/ui_journey_gap_audit.js`)
- [x] P77-T2 Project_A(가입->세션->설정 업로드->구독 검증)와 Project_B baseline을 Playwright로 실행하고 JSON/스크린샷 증적 수집 (`/tmp/ui-journey-audit`)
- [x] P77-T3 UI journey orchestration phase/sub-plan 문서 동기화 (`docs/ondev/20260216_02`, `docs/ondev/20260216_03`)
- [x] P78-T1 `PATCH /setting` 파일 업로드 플로우 구현 및 사용자 attachment 유지 (`test/integration/settings_flow_test.rb`)
- [ ] P78-T2 localhost Google OAuth consent 성공 외부 게이트: Google Console redirect URI 허용 후 callback success 증적 확보
- [x] P78-T3 Settings upload i18n 키(ko/en) 보강 및 Playwright 재검증 `gapCount=0`
- [x] P79-T1 Subscription UI를 `/setting#subscription`으로 통합하고 `/subscription`은 settings anchor로 리다이렉트
- [x] P79-T2 Settings 화면에 Subscription restore/validate 섹션 포함 및 통합 테스트 보강 (`settings_flow_test`, `subscription_flow_test`)
- [x] P79-T3 Top navigation에서 standalone Subscription 탭 제거, Settings 중심 UX로 정합화 (`home_flow_test`)
- [x] P80-T1 Project_B UI asset 재사용: `soletalk-logo-v2.png`, `feature-graphic.png`를 Project_A home/nav에 통합
- [x] P80-T2 Playwright user journey audit에 Project_B asset 존재 체크 추가 (`hasProjectBLogoAsset`, `hasProjectBFeatureGraphic`)
- [x] P80-T3 Project_B 대비 시각 정합화 2차: session overlay layout(`session-stage`, `session-overlay-top/bottom`) 반영 + Playwright 검증
- [x] P81-T1 Core UX Motion 2차: Canvas spark sprite 기반 고밀도 파티클(기본 1,800+) 렌더러 적용 (`particle_orb_controller`)
- [x] P81-T2 Core UX Motion 2차: density 기반 화면별 튜닝(home 1.2, session 1.0) + 모바일 가드레일(절전/저성능/감속) 유지
- [x] P81-T3 Core UX Motion 2차: JS unit test 확장(고밀도/밀도 스케일) 및 회귀 green (`npm run test:js`)
- [x] P83-T1 Login parity: Project_B 기준 로그인 카드 구조(email/password + Google CTA + consent gate 진입)를 Home guest 화면에 적용
- [x] P83-T2 Signup/Consent flow: `/sign_up`, `/consent` 화면 추가 및 Project_B legal 문서(`privacy-policy`, `terms-of-service`) 정적 이식
- [x] P83-T3 Opening sequence: 홈 진입 시 고밀도 파티클 + `SoleTalk` 로고 오프닝 오버레이 구현
- [x] P84-T1 Main surface parity: 로그인 후 메인 화면에 3D orb + 하단 마이크 버튼 + 좌상단 파일업로드/우상단 설정 액션 구현
- [x] P84-T2 Main/Auth parity 회귀: `home_flow_test`, `settings_flow_test`, `onboarding_flow_test` green 검증
- [x] P85-T1 Consent gate hardening: `/auth/google_oauth2/start`에서 웹 로그인은 동의 전 `/consent`로 강제 리다이렉트
- [x] P85-T2 Consent-accepted OAuth start regression: 동의 후에는 `/auth/google_oauth2/start -> /auth/google_oauth2` 유지
- [x] P85-T3 Guest entry parity: `POST /guest_sign_in` 경로 추가 및 guest session 진입 구현/검증
- [x] P86-T1 Main mic CTA wiring: 홈 메인 3D orb 하단 마이크 버튼을 `POST /sessions` 실제 세션 생성 동작과 연결
- [x] P86-T2 Login parity polish: guest 로그인 패널에 Project_B형 `or` divider + privacy/terms quick-link 배치
- [x] P87-T1 Main mic session bootstrap: 홈 메인 마이크 엔트리(`entrypoint=main_mic`)로 생성된 세션은 `auto_start_recording=1` 쿼리와 함께 세션 화면으로 리다이렉트
- [x] P87-T2 Main mic entrypoint wiring: 로그인 홈 마이크 폼이 `entrypoint=main_mic` hidden 필드를 포함하고 기존 `/sessions/new` 동선은 기존 동작 유지
- [x] P87-T3 Native bridge auto-start: 세션 화면 `native-bridge`가 `auto_start_recording=1`인 경우 bridge 가용 시 `startRecording()`을 자동 호출
- [x] P88-T1 Consent gate UI parity: `/consent` 화면에서 정책 열람 전에는 동의 체크박스/진행 CTA를 비활성화하고 열람 액션 후에만 활성화
- [x] P88-T2 Auth visual parity polish: signup/consent 카드에 Project_B 톤(브랜드 divider, 보조 안내 텍스트, 버튼 계층) 반영
- [x] P88-T3 Consent journey regression: onboarding 통합 테스트 + Playwright journey audit 재검증 (`GAP_COUNT=0`)

## Queue Note
- Android-first 외부 게이트(실기기 4종 이벤트 2xx 증적)는 완료했다.
- iOS는 실기기 부재로 `Deferred` 트랙으로 관리한다.
- App Store 관련 Remaining은 수동/외부 트랙 게이트로 별도 관리한다.
- 현재 실행 대상은 `P78-T2` (localhost Google OAuth consent 외부 게이트)다.
- 현재 실행 대상(병행 구현)은 `P88-T1` (consent UI gate parity)다.
- 현재 실행 대상(병행 구현)은 `P87-T1` (메인 마이크 진입 자동 녹음 부트스트랩)이다.
- 현재 실행 대상 외 병행 완료: `P88`(consent gate + signup/consent visual parity + Playwright 회귀).
- 현재 실행 대상 외 병행 완료: `P87`(메인 마이크 엔트리포인트 기반 세션 자동 녹음 부트스트랩).
- 현재 실행 대상 외 병행 완료: `P81`(파티클 오브 고밀도 모션 2차).
- 현재 실행 대상 외 병행 완료: `P83`(로그인/가입/동의/오프닝 UI) + `P84`(메인 orb + 업로드/설정/마이크).
- 현재 실행 대상 외 병행 완료: `P85`(동의 게이트 서버 강제 + 게스트 로그인 동작).
- 현재 실행 대상 외 병행 완료: `P86`(메인 마이크 CTA 동작 + 로그인 패널 정합화 polish).
- RevenueCat 운영 validate 트랙(`P76`)은 완료했다.
- 수동 검증 증적: `docs/ondev/20260216_01_subscription_validate_manual_smoke_checklist.md`
- UI journey 증적: `/tmp/ui-journey-audit/journey_report.json`, `docs/ondev/20260216_02_projectb_playwright_ui_journey_phase_plan.md`

## TDD Rule
- Always execute next unchecked item first.
- Red -> Green -> Refactor.
